{"version":3,"file":"mobx-hooks-form.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useContext } from 'react'\nimport { autorun, computed, action, observable } from 'mobx'\nimport { useLocalStore, observer } from 'mobx-react-lite'\nimport { isEmpty } from 'lodash'\nimport { pick } from 'lodash/fp'\nimport * as yup from 'yup'\n\nfunction getErrorsFromValidationError(validationError: yup.ValidationError): Errors {\n\tconst FIRST_ERROR = 0\n\treturn validationError.inner.reduce((errors, error) => {\n\t\treturn {\n\t\t\t...errors,\n\t\t\t[error.path]: error.errors[FIRST_ERROR],\n\t\t}\n\t}, {})\n}\n\nfunction validate(schema: yup.ObjectSchema<Values>, values: {}) {\n\ttry {\n\t\tschema.validateSync(values, { abortEarly: false, recursive: true })\n\t\treturn {}\n\t} catch (error) {\n\t\treturn getErrorsFromValidationError(error)\n\t}\n}\n\ninterface Values {\n\t[index: string]: yup.Schema<any>\n}\ninterface Touched {\n\t[index: string]: boolean\n}\ninterface Errors {\n\t[index: string]: string\n}\n\ninterface UseForm {\n\tscheme: yup.ObjectSchema<Values>\n\tinitialValues: Values\n\tname: string\n}\n\nclass Store {\n\tconstructor(props: UseForm) {\n\t\tconst { scheme, initialValues, name = '' } = props\n\t\tthis.scheme = scheme\n\t\tthis.formName = name\n\t\tthis.keys = Object.keys(initialValues)\n\t\tthis.values = initialValues || {}\n\n\t\tautorun(() => {\n\t\t\tthis.keys.forEach(key => {\n\t\t\t\tconst validation = this.validations[key]\n\t\t\t\tconst touched = this.touched[key]\n\t\t\t\tif (!validation) {\n\t\t\t\t\tdelete this.errors[key]\n\t\t\t\t} else if (touched) {\n\t\t\t\t\tthis.errors[key] = validation\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tformName: string\n\tscheme: yup.ObjectSchema<Values>\n\tkeys: string[]\n\n\t@observable values: Values\n\t@observable touched = {} as Touched\n\t@observable errors = {} as Errors\n\n\t@computed get validations() {\n\t\treturn validate(this.scheme, this.values)\n\t}\n\t@computed get isValid() {\n\t\treturn isEmpty(this.validations)\n\t}\n\n\t@action setValue = (key: string) => (value: any) => {\n\t\tthis.values[key] = value\n\t}\n\n\t@action touch = (key: string) => (this.touched[key] = true)\n\t@action touchAll = () =>\n\t\tthis.keys.forEach(key => {\n\t\t\tthis.touched[key] = true\n\t\t})\n\n\t@action updateValues = (values: Values) =>\n\t\tObject.assign(this.values, pick(this.keys)(values))\n\n\t@action handleChange = (key: string) => (e: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.setValue(key)(e.target.value)\n\t}\n\t@action handleCheckedChange = (key: string) => (\n\t\te: React.ChangeEvent<HTMLInputElement>\n\t) => {\n\t\tthis.setValue(key)(e.target.checked)\n\t}\n\t@action handleBlur = (key: string) => () => {\n\t\tthis.touch(key)\n\t}\n\n\tgetValue = (key: string) => this.values[key]\n\tgetError = (key: string) => this.errors[key]\n\tisRequired = (name: string) => (this.scheme.fields[name] as any)._exclusive.required\n\n\t@action handleSubmit = (submit: () => void) => (\n\t\te: React.ChangeEvent<HTMLInputElement>\n\t) => {\n\t\te.preventDefault()\n\t\tthis.touchAll()\n\t\tif (this.isValid) {\n\t\t\tsubmit()\n\t\t}\n\t}\n}\n\nexport const useForm = (props: UseForm) =>\n\tuseLocalStore(source => new Store(source), props)\n\nconst FormContext = React.createContext({} as ReturnType<typeof useForm>)\nexport const useFormContext = () => useContext(FormContext)\nexport const FormContextProvider = ({\n\tchildren,\n\tformStore,\n}: {\n\tchildren: React.ReactChildren\n\tformStore: ReturnType<typeof useForm>\n}) => <FormContext.Provider value={formStore}>{children}</FormContext.Provider>\n\nconst FieldContext = React.createContext({})\nexport const useFieldContext = () => useContext(FieldContext)\nexport const FieldContextProvider = observer(\n\t({\n\t\tchildren,\n\t\tname,\n\t}: {\n\t\tchildren: (arg0: any) => React.ReactNode | React.ReactChildren\n\t\tname: string\n\t}) => {\n\t\tconst store = useContext(FormContext)\n\n\t\tconst fieldContext = {\n\t\t\tname,\n\t\t\tid: `${store.formName}_${name}`,\n\t\t\tsetValue: store.setValue(name),\n\t\t\terror: store.getError(name),\n\t\t\tvalue: store.getValue(name),\n\t\t\tonBlur: store.handleBlur(name),\n\t\t\tonChange: store.handleChange(name),\n\t\t\tonCheckedChange: store.handleCheckedChange(name),\n\t\t\tisRequired: store.isRequired(name),\n\t\t}\n\n\t\treturn (\n\t\t\t<FieldContext.Provider value={fieldContext}>\n\t\t\t\t{typeof children === 'function' ? children(fieldContext) : children}\n\t\t\t</FieldContext.Provider>\n\t\t)\n\t}\n)\n\n// Object.keys(state.errors).forEach(key => {\n// if (!has(key)(state.validations)) {\n// delete state.errors[key]\n// }\n// })\n// @action validationsToErrors() {\n//     Object.keys(state.errors).forEach(key => {\n//         if (!has(key)(state.validations)) {\n//             delete state.errors[key]\n//         }\n//     })\n//     Object.entries(state.validations).forEach(([key, value]) => {\n//         if (state.touched[key]) {\n//             state.errors[key] = value\n//         }\n//     })\n// }\n// state.validationsToErrors()\n// autorun(() => {\n//     state.validationsToErrors()\n// })\n// @observable errors = {} as Errors\n// @computed get errors() {\n// \tconst errors = {} as Errors\n// \tObject.entries(this.validations).forEach(([key, value]) => {\n// \t\tif (this.touched[key]) {\n// \t\t\terrors[key] = value\n// \t\t}\n// \t})\n// \treturn errors\n// }\n// export function useForm(props: UseForm) {\n// \tconst state = useLocalStore(source => new Store(source), props)\n\n// \treturn {\n// \t\tgetValue: state.getValue,\n// \t\tgetError: state.getError,\n// \t\tupdateValues: state.updateValues,\n// \t\tsetValue: state.setValue,\n// \t\tgetValues: state.getValues,\n// \t\tisValid: () => state.isValid,\n// \t\thandleChange: state.handleChange,\n// \t\thandleCheckedChange: state.handleCheckedChange,\n// \t\thandleBlur: state.handleBlur,\n// \t\tformName: state.formName,\n// \t\tgetFieldProps: state.getFieldProps,\n// \t\thandleSubmit: state.handleSubmit,\n// \t\tisRequired: state.isRequired,\n// \t}\n// }\n"],"names":["getErrorsFromValidationError","validationError","FIRST_ERROR","inner","reduce","errors","error","path","validate","schema","values","validateSync","abortEarly","recursive","Store","props","key","value","touched","keys","forEach","Object","assign","pick","e","setValue","target","checked","touch","name","scheme","fields","_exclusive","required","submit","preventDefault","touchAll","isValid","initialValues","formName","autorun","validation","validations","isEmpty","__decorate","observable","computed","action","useForm","useLocalStore","source","FormContext","React","createContext","useFormContext","useContext","FormContextProvider","children","formStore","Provider","FieldContext","useFieldContext","FieldContextProvider","observer","store","fieldContext","id","getError","getValue","onBlur","handleBlur","onChange","handleChange","onCheckedChange","handleCheckedChange","isRequired"],"mappings":"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"}